<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
		<head>
			<!-- template designed by Marco Von Ballmoos -->
			<title>File Source for AlarmModel.class.php</title>
			<link rel="stylesheet" href="../media/stylesheet.css" />
			<meta http-equiv='Content-Type' content='text/html; charset=iso-8859-1'/>
		</head>
		<body>
						<h1>Source for file AlarmModel.class.php</h1>
<p>Documentation is available at <a href="../Alarm/_AlarmModel_class_php.html">AlarmModel.class.php</a></p>
<div class="src-code">
<pre><ol><li><a name="a1"></a><span class="src-php">&lt;?php</span></li>
<li><a name="a2"></a>&nbsp;</li>
<li><a name="a3"></a><span class="src-doc">/**</span></li>
<li><a name="a4"></a><span class="src-doc"> * Classe AlarmModel</span></li>
<li><a name="a5"></a><span class="src-doc"> * </span></li>
<li><a name="a6"></a><span class="src-doc"> * Cette classe définit le modele de donnees des alarmes</span></li>
<li><a name="a7"></a><span class="src-doc"> * </span></li>
<li><a name="a8"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@package</span><span class="src-doc"> Alarm</span></li>
<li><a name="a9"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@author</span><span class="src-doc"> BAC b.audic@astellia.com</span></li>
<li><a name="a10"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@version</span><span class="src-doc"> 1.0.0</span></li>
<li><a name="a11"></a><span class="src-doc"> * </span><span class="src-doc-coretag">@copyright</span><span class="src-doc"> 2008 Astellia</span></li>
<li><a name="a12"></a><span class="src-doc"> *</span></li>
<li><a name="a13"></a><span class="src-doc"> */</span></li>
<li><a name="a14"></a>&nbsp;</li>
<li><a name="a15"></a><span class="src-sym">@</span><a href="http://www.php.net/session_start">session_start</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a16"></a>&nbsp;</li>
<li><a name="a17"></a><span class="src-inc">include_once </span><span class="src-str">'DataBaseConnectionMySQL.class.php'</span><span class="src-sym">;</span></li>
<li><a name="a18"></a>&nbsp;</li>
<li><a name="a19"></a><span class="src-key">class </span><a href="../Alarm/AlarmModel.html">AlarmModel</a></li>
<li><a name="a20"></a><span class="src-sym">{</span></li>
<li><a name="a21"></a>    <span class="src-doc">/**</span></li>
<li><a name="a22"></a><span class="src-doc">     * Instance de la classe de connexion à la base de données</span></li>
<li><a name="a23"></a><span class="src-doc">     *</span></li>
<li><a name="a24"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@var </span><span class="src-doc-type">object </span></li>
<li><a name="a25"></a><span class="src-doc">     */</span></li>
<li><a name="a26"></a>    </li>
<li><a name="a27"></a>    <span class="src-key">private </span><a href="../Alarm/AlarmModel.html#var$db_connection">$db_connection</a><span class="src-sym">;</span></li>
<li><a name="a28"></a>    </li>
<li><a name="a29"></a>    <span class="src-doc">/**</span></li>
<li><a name="a30"></a><span class="src-doc">     * Liste des messages affichés dans l'application</span></li>
<li><a name="a31"></a><span class="src-doc">     *</span></li>
<li><a name="a32"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@var </span><span class="src-doc-type">array </span></li>
<li><a name="a33"></a><span class="src-doc">     */</span></li>
<li><a name="a34"></a>&nbsp;</li>
<li><a name="a35"></a>    <span class="src-key">private </span><a href="../Alarm/AlarmModel.html#var$messages">$messages</a> = <span class="src-key">array</span><span class="src-sym">(    </span></li>
<li><a name="a36"></a>                                <span class="src-str">'A_TASK_SCHEDULER_SCHEDULE_SETUP_LIST_TITLE_AVAILABLE_GROUP'</span>=&gt;<span class="src-str">'Available groups'</span><span class="src-sym">,</span></li>
<li><a name="a37"></a>                                <span class="src-str">'A_TASK_SCHEDULER_SCHEDULE_SETUP_LIST_TITLE_SUSCRIBED_GROUP'</span>=&gt;<span class="src-str">'Subscribed groups'</span><span class="src-sym">,</span></li>
<li><a name="a38"></a>                                <span class="src-str">'A_ALARM_FORM_LABEL_ALARM_NAME'</span>=&gt;<span class="src-str">'Alarm Name'</span><span class="src-sym">,</span></li>
<li><a name="a39"></a>                                <span class="src-str">'A_ALARM_FORM_LABEL_NETWORK_LEVEL'</span>=&gt;<span class="src-str">'Level'</span><span class="src-sym">,</span></li>
<li><a name="a40"></a>                                <span class="src-str">'A_ALARM_FORM_LABEL_TIME_RESOLUTION'</span>=&gt;<span class="src-str">'Time resolution'</span><span class="src-sym">,</span></li>
<li><a name="a41"></a>                                <span class="src-str">'A_ALARM_DESACTIVATED_INFORMATION'</span>=&gt;<span class="src-str">'Alarms in orange are desactivated'</span><span class="src-sym">,</span></li>
<li><a name="a42"></a>                                <span class="src-str">'A_PAUTO_CONFIRM_OBJECT_DELETE'</span>=&gt;<span class="src-str">'Are you sure you want to delete this element ?'</span><span class="src-sym">,</span></li>
<li><a name="a43"></a>                                <span class="src-str">'A_ALARM_ALARM_LIST'</span>=&gt;<span class="src-str">'Alarm List'</span><span class="src-sym">,</span></li>
<li><a name="a44"></a>                                <span class="src-str">'A_ALARM_GROUP_SELECTOR'</span>=&gt;<span class="src-str">'Group selector'</span><span class="src-sym">,</span></li>
<li><a name="a45"></a>                                <span class="src-str">'A_ALARM_EMAIL_SETUP_TITLE'</span>=&gt;<span class="src-str">'Email Sending'</span><span class="src-sym">,</span></li>
<li><a name="a46"></a>                                <span class="src-str">'A_ALARM_NO_ALARM_REGISTRED'</span>=&gt;<span class="src-str">'No alarm registered.'</span><span class="src-sym">,</span></li>
<li><a name="a47"></a>                                <span class="src-str">'A_ALARM_DELETE_CONFIRMATION_TITLE'</span>=&gt;<span class="src-str">'Deletion confirmation'</span><span class="src-sym">,</span></li>
<li><a name="a48"></a>                                <span class="src-str">'A_ALARM_BTN_NEW_ALARM'</span>=&gt;<span class="src-str">'New $1 Alarm'</span><span class="src-sym">,</span></li>
<li><a name="a49"></a>                                <span class="src-str">'G_PROFILE_FORM_LINK_BACK_TO_THE_LIST'</span>=&gt;<span class="src-str">'Back to the list'</span><span class="src-sym">,</span></li>
<li><a name="a50"></a>                                <span class="src-str">'A_ALARM_ALARM_PROPERTIES_LABEL'</span>=&gt;<span class="src-str">'Alarm properties'</span><span class="src-sym">,</span></li>
<li><a name="a51"></a>                                <span class="src-str">'A_ALARM_FORM_LABEL_ALARM_DESCRIPTION'</span>=&gt;<span class="src-str">'Alarm Description'</span><span class="src-sym">,</span></li>
<li><a name="a52"></a>                                <span class="src-str">'A_ALARM_FORM_LABEL_ALARM_CALCULATION_ACTIVATED'</span>=&gt;<span class="src-str">'Alarm calculation activated'</span><span class="src-sym">,</span></li>
<li><a name="a53"></a>                                <span class="src-str">'A_ALARM_FORM_LABEL_ADDITIONAL_FIELD'</span>=&gt;<span class="src-str">'Additional field'</span><span class="src-sym">,</span></li>
<li><a name="a54"></a>                                <span class="src-str">'A_ALARM_FORM_LABEL_TRIGGER'</span>=&gt;<span class="src-str">'Trigger'</span><span class="src-sym">,</span></li>
<li><a name="a55"></a>                                <span class="src-str">'A_ALARM_FORM_FIELDSET_ADDITIONAL_FIELD_LIST'</span>=&gt;<span class="src-str">'Additional field list'</span><span class="src-sym">,</span></li>
<li><a name="a56"></a>                                <span class="src-str">'A_ADVANCED_CONTEXT_TYPE_LABEL'</span>=&gt;<span class="src-str">'Type'</span><span class="src-sym">,</span></li>
<li><a name="a57"></a>                                <span class="src-str">'A_ALARM_SELECT_MAKE_A_SELECTION_LABEL'</span>=&gt;<span class="src-str">'Make a Selection'</span><span class="src-sym">,</span></li>
<li><a name="a58"></a>                                <span class="src-str">'A_ALARM_NFORMATION_TRIGGER'</span>=&gt;<span class="src-str">'(Triggers are linked using an \'AND\' condition)'</span><span class="src-sym">,</span></li>
<li><a name="a59"></a>                                <span class="src-str">'A_ALARM_FORM_FIELDSET_TRIGGER_LIST'</span>=&gt;<span class="src-str">'Trigger list'</span><span class="src-sym">,</span></li>
<li><a name="a60"></a>                                <span class="src-str">'A_ALARM_FORM_BTN_ADD_TRIGGER'</span>=&gt;<span class="src-str">'Add a trigger'</span><span class="src-sym">,</span></li>
<li><a name="a61"></a>                                <span class="src-str">'A_TITRE_FENETRE_NETWORK_ELEMENT_SELECTION_ALARMES_SETUP'</span>=&gt;<span class="src-str">'ID/Account Selection'</span><span class="src-sym">,</span></li>
<li><a name="a62"></a>                                <span class="src-str">'A_NO_NA_FOR_FAMILY_LABEL'</span>=&gt;<span class="src-str">'No network agregation for $1'</span><span class="src-sym">,</span></li>
<li><a name="a63"></a>                                <span class="src-str">'A_NO_TA_LABEL'</span>=&gt;<span class="src-str">'No time agregation'</span></li>
<li><a name="a64"></a>                            <span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a65"></a>&nbsp;</li>
<li><a name="a66"></a>    <span class="src-doc">/**</span></li>
<li><a name="a67"></a><span class="src-doc">     * Constructeur de la classe</span></li>
<li><a name="a68"></a><span class="src-doc">     *</span></li>
<li><a name="a69"></a><span class="src-doc">     */</span></li>
<li><a name="a70"></a>&nbsp;</li>
<li><a name="a71"></a>     <span class="src-key">public </span><span class="src-key">function </span><a href="../Alarm/AlarmModel.html#method__construct">__construct</a><span class="src-sym">(</span><span class="src-var">$db_conf_url </span>= <span class="src-str">''</span><span class="src-sym">)</span></li>
<li><a name="a72"></a>     <span class="src-sym">{</span></li>
<li><a name="a73"></a>        <span class="src-key">if</span><span class="src-sym">(</span><span class="src-key">empty</span><span class="src-sym">(</span><span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'ast_DBConnection'</span><span class="src-sym">]</span><span class="src-sym">)) </span><span class="src-sym">{</span></li>
<li><a name="a74"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a> = <span class="src-key">new </span><span class="src-id"><a href="../Alarm/DataBaseConnectionMySQL.html">DataBaseConnectionMySQL</a></span><span class="src-sym">(</span><span class="src-var">$db_conf_url</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a75"></a>            <span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'ast_DBConnection'</span><span class="src-sym">] </span>= <a href="http://www.php.net/serialize">serialize</a><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a76"></a>        <span class="src-sym">}</span></li>
<li><a name="a77"></a>        <span class="src-key">else </span></li>
<li><a name="a78"></a>        <span class="src-sym">{</span></li>
<li><a name="a79"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a> = <a href="http://www.php.net/unserialize">unserialize</a><span class="src-sym">(</span><span class="src-var">$_SESSION</span><span class="src-sym">[</span><span class="src-str">'ast_DBConnection'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a80"></a>        <span class="src-sym">}</span></li>
<li><a name="a81"></a>    <span class="src-sym">}</span></li>
<li><a name="a82"></a>        </li>
<li><a name="a83"></a>    <span class="src-doc">/**</span></li>
<li><a name="a84"></a><span class="src-doc">     * Retourne la liste des alarmes d'une famille et d'un type donné</span></li>
<li><a name="a85"></a><span class="src-doc">     *</span></li>
<li><a name="a86"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$family </span><span class="src-doc">famille des alarmes recherchées</span></li>
<li><a name="a87"></a><span class="src-doc">      * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$type </span><span class="src-doc">type des alarmes recherchées</span></li>
<li><a name="a88"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">la liste des alarmes recherchées</span></li>
<li><a name="a89"></a><span class="src-doc">     */</span></li>
<li><a name="a90"></a>&nbsp;</li>
<li><a name="a91"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetAlarmList">getAlarmList</a><span class="src-sym">(</span><span class="src-var">$family</span><span class="src-sym">, </span><span class="src-var">$type</span><span class="src-sym">)</span></li>
<li><a name="a92"></a>    <span class="src-sym">{</span></li>
<li><a name="a93"></a>        <span class="src-var">$sql </span>=     <span class="src-str">&quot; SELECT DISTINCT alarm_id, alarm_name, network, time, on_off,&quot;</span></li>
<li><a name="a94"></a>                .<span class="src-str">&quot; (&quot;</span></li>
<li><a name="a95"></a>                .<span class="src-str">&quot;        SELECT CASE WHEN (COUNT(id_group) &gt; 0) THEN true ELSE false END&quot;</span></li>
<li><a name="a96"></a>                .<span class="src-str">&quot;        FROM sys_alarm_email_sender&quot;</span></li>
<li><a name="a97"></a>                .<span class="src-str">&quot;        WHERE id_alarm = alarm_id AND time_aggregation = time AND alarm_type = 'alarm_&quot;</span>.<span class="src-var">$type</span>.<span class="src-str">&quot;'&quot;</span></li>
<li><a name="a98"></a>                .<span class="src-str">&quot; ) AS send_mail&quot;</span></li>
<li><a name="a99"></a>                .<span class="src-str">&quot; FROM sys_definition_alarm_&quot;</span>.<span class="src-var">$type</span></li>
<li><a name="a100"></a>                .<span class="src-str">&quot; WHERE family = '&quot;</span>.<span class="src-var">$family</span>.<span class="src-str">&quot;' ORDER BY alarm_id&quot;</span><span class="src-sym">;</span></li>
<li><a name="a101"></a>&nbsp;</li>
<li><a name="a102"></a>        <span class="src-var">$req </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a103"></a>        <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">getQueryResults</span><span class="src-sym">(</span><span class="src-var">$req</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a104"></a>    <span class="src-sym">}</span></li>
<li><a name="a105"></a>    </li>
<li><a name="a106"></a>    <span class="src-doc">/**</span></li>
<li><a name="a107"></a><span class="src-doc">     * Retourne la liste des groupes de destinataires de l'alarme</span></li>
<li><a name="a108"></a><span class="src-doc">     *</span></li>
<li><a name="a109"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">integer </span><span class="src-doc-var">$alarm_id </span><span class="src-doc">identifiant de l'alarme</span></li>
<li><a name="a110"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$alarm_type </span><span class="src-doc">type de l'alarme</span></li>
<li><a name="a111"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">la liste des groupes destinataires de l'alarme</span></li>
<li><a name="a112"></a><span class="src-doc">     */</span></li>
<li><a name="a113"></a>&nbsp;</li>
<li><a name="a114"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetAlarmSuscribers">getAlarmSuscribers</a><span class="src-sym">(</span><span class="src-var">$alarm_id</span><span class="src-sym">, </span><span class="src-var">$alarm_type</span><span class="src-sym">)</span></li>
<li><a name="a115"></a>    <span class="src-sym">{</span></li>
<li><a name="a116"></a>        <span class="src-comm">//$sql = &quot;SELECT DISTINCT saes.id_group AS id, sug.group_name AS name FROM sys_alarm_email_sender saes, sys_user_group sug WHERE saes.id_alarm=&quot;.$alarm_id.&quot; AND saes.alarm_type='alarm_&quot;.$alarm_type.&quot;' AND saes.id_group = sug.id_group ORDER BY sug.group_name&quot;;</span></li>
<li><a name="a117"></a>&nbsp;</li>
<li><a name="a118"></a>        <span class="src-var">$sql </span>=     <span class="src-str">&quot; SELECT DISTINCT saes.id_group AS id, agr.AGR_NAME AS name&quot;</span></li>
<li><a name="a119"></a>                .<span class="src-str">&quot; FROM sys_alarm_email_sender saes, alk_group agr&quot;</span></li>
<li><a name="a120"></a>                .<span class="src-str">&quot; WHERE saes.id_alarm=&quot;</span>.<span class="src-var">$alarm_id</span>.<span class="src-str">&quot; AND saes.alarm_type='alarm_&quot;</span>.<span class="src-var">$alarm_type</span>.<span class="src-str">&quot;'&quot;</span></li>
<li><a name="a121"></a>                .<span class="src-str">&quot; AND saes.id_group = agr.AGR_ID ORDER BY agr.AGR_NAME&quot;</span><span class="src-sym">;</span></li>
<li><a name="a122"></a>&nbsp;</li>
<li><a name="a123"></a>        <span class="src-var">$req </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a124"></a>        <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">getQueryResults</span><span class="src-sym">(</span><span class="src-var">$req</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a125"></a>    <span class="src-sym">}</span></li>
<li><a name="a126"></a>    </li>
<li><a name="a127"></a>    <span class="src-doc">/**</span></li>
<li><a name="a128"></a><span class="src-doc">     * Permet de sauvegarder la sélection de groupes de destinataires attachés à une alarme</span></li>
<li><a name="a129"></a><span class="src-doc">     *</span></li>
<li><a name="a130"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">integer </span><span class="src-doc-var">$alarm_id </span><span class="src-doc">identifiant de l'alarme</span></li>
<li><a name="a131"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$alarm_ta </span><span class="src-doc">valeur de l'agregation temporelle de l'alarme</span></li>
<li><a name="a132"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$alarm_type </span><span class="src-doc">type de l'alarme</span></li>
<li><a name="a133"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">array </span><span class="src-doc-var">$suscribers_list </span><span class="src-doc">liste des destinataires de l'alarme</span></li>
<li><a name="a134"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">boolean </span><span class="src-doc">état de l'insertion des destinataires de l'alarme dans la BD</span></li>
<li><a name="a135"></a><span class="src-doc">     */</span></li>
<li><a name="a136"></a>&nbsp;</li>
<li><a name="a137"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodsaveAlarmSuscribers">saveAlarmSuscribers</a><span class="src-sym">(</span><span class="src-var">$alarm_id</span><span class="src-sym">, </span><span class="src-var">$alarm_ta</span><span class="src-sym">, </span><span class="src-var">$alarm_type</span><span class="src-sym">, </span><span class="src-var">$suscribers_list</span><span class="src-sym">)</span></li>
<li><a name="a138"></a>    <span class="src-sym">{        </span></li>
<li><a name="a139"></a>        <span class="src-var">$insert_ok </span>= <span class="src-id">true</span><span class="src-sym">;    </span><span class="src-comm">// etat de l'insertion</span></li>
<li><a name="a140"></a>&nbsp;</li>
<li><a name="a141"></a>        <span class="src-comm">// On supprime tout d'abord la liste des destinataires déja défini pour l'alarme</span></li>
<li><a name="a142"></a>&nbsp;</li>
<li><a name="a143"></a>        <span class="src-var">$sql </span>= <span class="src-str">&quot;DELETE FROM sys_alarm_email_sender WHERE id_alarm = &quot;</span>.<span class="src-var">$alarm_id</span>.<span class="src-str">&quot; AND time_aggregation = '&quot;</span>.<span class="src-var">$alarm_ta</span>.<span class="src-str">&quot;' AND alarm_type = 'alarm_&quot;</span>.<span class="src-var">$alarm_type</span>.<span class="src-str">&quot;'&quot;</span><span class="src-sym">;</span></li>
<li><a name="a144"></a>        <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a145"></a>&nbsp;</li>
<li><a name="a146"></a>        <span class="src-comm">//echo $sql;</span></li>
<li><a name="a147"></a>&nbsp;</li>
<li><a name="a148"></a>        <span class="src-comm">// On (re)insere ensuite la liste des destinataires sélectionnés pour l'alarme</span></li>
<li><a name="a149"></a>        </li>
<li><a name="a150"></a>        <span class="src-key">for </span><span class="src-sym">(</span><span class="src-var">$i</span>=<span class="src-num">0</span><span class="src-sym">; </span><span class="src-var">$i </span>&lt; <a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$suscribers_list</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-var">$i</span>++<span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a151"></a>            <span class="src-var">$sql </span>=     <span class="src-str">&quot; INSERT INTO sys_alarm_email_sender(id_alarm, id_group, time_aggregation, alarm_type)&quot;</span></li>
<li><a name="a152"></a>                    .<span class="src-str">&quot; VALUES (&quot;</span>.<span class="src-var">$alarm_id</span>.<span class="src-str">&quot;, &quot;</span>.<span class="src-var">$suscribers_list</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span>.<span class="src-str">&quot;, '&quot;</span>.<span class="src-var">$alarm_ta</span>.<span class="src-str">&quot;', 'alarm_&quot;</span>.<span class="src-var">$alarm_type</span>.<span class="src-str">&quot;')&quot;</span><span class="src-sym">;</span></li>
<li><a name="a153"></a>            </li>
<li><a name="a154"></a>            <span class="src-var">$insert_ok </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">; </span></li>
<li><a name="a155"></a>        <span class="src-sym">}</span></li>
<li><a name="a156"></a>        </li>
<li><a name="a157"></a>        <span class="src-key">return </span><span class="src-var">$insert_ok</span><span class="src-sym">;</span></li>
<li><a name="a158"></a>    <span class="src-sym">}</span></li>
<li><a name="a159"></a>    </li>
<li><a name="a160"></a>    <span class="src-doc">/**</span></li>
<li><a name="a161"></a><span class="src-doc">     * Retourne les groupes disponibles dans l'application</span></li>
<li><a name="a162"></a><span class="src-doc">     *</span></li>
<li><a name="a163"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">la liste des groupes de l'application</span></li>
<li><a name="a164"></a><span class="src-doc">     */</span></li>
<li><a name="a165"></a>&nbsp;</li>
<li><a name="a166"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetApplicationGroups">getApplicationGroups</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a167"></a>    <span class="src-sym">{</span></li>
<li><a name="a168"></a>        <span class="src-comm">//$sql = &quot;SELECT DISTINCT id_group AS id, group_name AS name FROM sys_user_group WHERE on_off = 1 ORDER BY group_name ASC&quot;;</span></li>
<li><a name="a169"></a>        <span class="src-var">$sql </span>= <span class="src-str">&quot;SELECT AGR_ID AS id, AGR_NAME AS name FROM alk_group ORDER BY name&quot;</span><span class="src-sym">;</span></li>
<li><a name="a170"></a>        <span class="src-var">$req </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a171"></a>        <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">getQueryResults</span><span class="src-sym">(</span><span class="src-var">$req</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a172"></a>    <span class="src-sym">}</span></li>
<li><a name="a173"></a>    </li>
<li><a name="a174"></a>    <span class="src-doc">/**</span></li>
<li><a name="a175"></a><span class="src-doc">     * Retourne les propirétés d'une alarme</span></li>
<li><a name="a176"></a><span class="src-doc">     *</span></li>
<li><a name="a177"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">integer </span><span class="src-doc-var">$alarm_id </span><span class="src-doc">identifiant de l'alarme</span></li>
<li><a name="a178"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$family </span><span class="src-doc">famille de l'alarme</span></li>
<li><a name="a179"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$type </span><span class="src-doc">type de l'alarme</span></li>
<li><a name="a180"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">les propriétés de l'alarme</span></li>
<li><a name="a181"></a><span class="src-doc">     */</span></li>
<li><a name="a182"></a>&nbsp;</li>
<li><a name="a183"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetAlarmProperties">getAlarmProperties</a><span class="src-sym">(</span><span class="src-var">$alarm_id</span><span class="src-sym">, </span><span class="src-var">$family</span><span class="src-sym">, </span><span class="src-var">$type </span>= <span class="src-str">&quot;static&quot;</span><span class="src-sym">)</span></li>
<li><a name="a184"></a>    <span class="src-sym">{</span></li>
<li><a name="a185"></a>        <span class="src-comm">// Note : peut être compléter la requete avec une sous-requete sur la table des elements réseaux</span></li>
<li><a name="a186"></a>&nbsp;</li>
<li><a name="a187"></a>        <span class="src-var">$sql </span>= <span class="src-str">&quot;SELECT * FROM sys_definition_alarm_&quot;</span>.<span class="src-var">$type</span>.<span class="src-str">&quot; WHERE alarm_id = &quot;</span>.<span class="src-var">$alarm_id</span>.<span class="src-str">&quot; AND family = '&quot;</span>.<span class="src-var">$family</span>.<span class="src-str">&quot;'&quot;</span><span class="src-sym">;</span></li>
<li><a name="a188"></a>        <span class="src-var">$req </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a189"></a>        <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">getQueryResults</span><span class="src-sym">(</span><span class="src-var">$req</span><span class="src-sym">, </span><span class="src-str">&quot;one&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a190"></a>    <span class="src-sym">}</span></li>
<li><a name="a191"></a>    </li>
<li><a name="a192"></a>    <span class="src-doc">/**</span></li>
<li><a name="a193"></a><span class="src-doc">     * Retourne les triggers définis pour une alarme</span></li>
<li><a name="a194"></a><span class="src-doc">     *</span></li>
<li><a name="a195"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">integer </span><span class="src-doc-var">$alarm_id </span><span class="src-doc">identifiant de l'alarme</span></li>
<li><a name="a196"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$family </span><span class="src-doc">famille de l'alarme</span></li>
<li><a name="a197"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$type </span><span class="src-doc">type de l'alarme</span></li>
<li><a name="a198"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">la liste des triggers de l'alarme</span></li>
<li><a name="a199"></a><span class="src-doc">     */</span></li>
<li><a name="a200"></a>&nbsp;</li>
<li><a name="a201"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetAlarmTrigger">getAlarmTrigger</a><span class="src-sym">(</span><span class="src-var">$alarm_id</span><span class="src-sym">, </span><span class="src-var">$family</span><span class="src-sym">, </span><span class="src-var">$type </span>= <span class="src-str">&quot;static&quot;</span><span class="src-sym">)</span></li>
<li><a name="a202"></a>    <span class="src-sym">{</span></li>
<li><a name="a203"></a>        <span class="src-var">$sql </span>=     <span class="src-str">&quot; SELECT DISTINCT alarm_trigger_data_field, alarm_trigger_operand, alarm_trigger_type, alarm_trigger_value, critical_level&quot;</span></li>
<li><a name="a204"></a>                .<span class="src-str">&quot; FROM sys_definition_alarm_&quot;</span>.<span class="src-var">$type</span></li>
<li><a name="a205"></a>                .<span class="src-str">&quot; WHERE alarm_id = &quot;</span>.<span class="src-var">$alarm_id</span>.<span class="src-str">&quot; AND family = '&quot;</span>.<span class="src-var">$family</span>.<span class="src-str">&quot;' AND alarm_trigger_data_field IS NOT NULL&quot;</span><span class="src-sym">;</span><span class="src-comm">// AND on_off = 1&quot;;</span></li>
<li><a name="a206"></a>        </li>
<li><a name="a207"></a>        <span class="src-var">$req </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a208"></a>        <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">getQueryResults</span><span class="src-sym">(</span><span class="src-var">$req</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a209"></a>    <span class="src-sym">}</span></li>
<li><a name="a210"></a>    </li>
<li><a name="a211"></a>    <span class="src-doc">/**</span></li>
<li><a name="a212"></a><span class="src-doc">     * Retourne les champs additionnels d'une alarme</span></li>
<li><a name="a213"></a><span class="src-doc">     *</span></li>
<li><a name="a214"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">integer </span><span class="src-doc-var">$alarm_id </span><span class="src-doc">identifiant de l'alarme</span></li>
<li><a name="a215"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$family </span><span class="src-doc">famille de l'alarme</span></li>
<li><a name="a216"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$type </span><span class="src-doc">type de l'alarme</span></li>
<li><a name="a217"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">la liste des champs additionnels de l'alarme</span></li>
<li><a name="a218"></a><span class="src-doc">     */</span></li>
<li><a name="a219"></a>&nbsp;</li>
<li><a name="a220"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetAlarmAdditionnalFields">getAlarmAdditionnalFields</a><span class="src-sym">(</span><span class="src-var">$alarm_id</span><span class="src-sym">, </span><span class="src-var">$family</span><span class="src-sym">, </span><span class="src-var">$type </span>= <span class="src-str">&quot;static&quot;</span><span class="src-sym">)</span></li>
<li><a name="a221"></a>    <span class="src-sym">{</span></li>
<li><a name="a222"></a>        <span class="src-var">$sql </span>=     <span class="src-str">&quot; SELECT DISTINCT additional_field AS id, additional_field_type AS type&quot;</span></li>
<li><a name="a223"></a>                .<span class="src-str">&quot; FROM sys_definition_alarm_&quot;</span>.<span class="src-var">$type</span></li>
<li><a name="a224"></a>                .<span class="src-str">&quot; WHERE alarm_id = &quot;</span>.<span class="src-var">$alarm_id</span>.<span class="src-str">&quot; AND family = '&quot;</span>.<span class="src-var">$family</span>.<span class="src-str">&quot;' AND alarm_trigger_data_field IS NULL&quot;</span><span class="src-sym">;</span><span class="src-comm">// AND on_off = 1&quot;;</span></li>
<li><a name="a225"></a>        </li>
<li><a name="a226"></a>        <span class="src-var">$req </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a227"></a>        <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">getQueryResults</span><span class="src-sym">(</span><span class="src-var">$req</span><span class="src-sym">)</span><span class="src-sym">;        </span></li>
<li><a name="a228"></a>    <span class="src-sym">}</span></li>
<li><a name="a229"></a>    </li>
<li><a name="a230"></a>    <span class="src-doc">/**</span></li>
<li><a name="a231"></a><span class="src-doc">     * Retourne les valeurs des triggers d'une alarme en fonction d'un niveau de criticité sélectionné</span></li>
<li><a name="a232"></a><span class="src-doc">     *</span></li>
<li><a name="a233"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">integer </span><span class="src-doc-var">$alarm_id </span><span class="src-doc">identifiant de l'alarme</span></li>
<li><a name="a234"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$family </span><span class="src-doc">famille de l'alarme</span></li>
<li><a name="a235"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$criticity </span><span class="src-doc">le niveau de criticité de l'alarme</span></li>
<li><a name="a236"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$type </span><span class="src-doc">type de l'alarme</span></li>
<li><a name="a237"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">les valeurs des triggers de l'alarme</span></li>
<li><a name="a238"></a><span class="src-doc">     */</span></li>
<li><a name="a239"></a>&nbsp;</li>
<li><a name="a240"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetAlarmCriticityValues">getAlarmCriticityValues</a><span class="src-sym">(</span><span class="src-var">$alarm_id</span><span class="src-sym">, </span><span class="src-var">$family</span><span class="src-sym">, </span><span class="src-var">$criticity</span><span class="src-sym">, </span><span class="src-var">$type </span>= <span class="src-str">&quot;static&quot;</span><span class="src-sym">)</span></li>
<li><a name="a241"></a>    <span class="src-sym">{</span></li>
<li><a name="a242"></a>        <span class="src-var">$sql </span>=     <span class="src-str">&quot; SELECT DISTINCT alarm_trigger_data_field AS id, alarm_trigger_operand AS operand,&quot;</span></li>
<li><a name="a243"></a>                .<span class="src-str">&quot; alarm_trigger_type AS type, alarm_trigger_value AS value&quot;</span></li>
<li><a name="a244"></a>                .<span class="src-str">&quot; FROM sys_definition_alarm_&quot;</span>.<span class="src-var">$type</span></li>
<li><a name="a245"></a>                .<span class="src-str">&quot; WHERE alarm_id = &quot;</span>.<span class="src-var">$alarm_id</span>.<span class="src-str">&quot; AND family = '&quot;</span>.<span class="src-var">$family</span>.<span class="src-str">&quot;' AND critical_level = '&quot;</span>.<span class="src-var">$criticity</span>.<span class="src-str">&quot;'&quot;</span></li>
<li><a name="a246"></a>                .<span class="src-str">&quot; AND alarm_trigger_data_field IS NOT NULL&quot;</span><span class="src-sym">;</span><span class="src-comm">// AND on_off = 1&quot;;</span></li>
<li><a name="a247"></a>        </li>
<li><a name="a248"></a>        <span class="src-var">$req </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a249"></a>&nbsp;</li>
<li><a name="a250"></a>        <span class="src-var">$results </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">getQueryResults</span><span class="src-sym">(</span><span class="src-var">$req</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a251"></a>&nbsp;</li>
<li><a name="a252"></a>        <span class="src-key">if </span><span class="src-sym">(</span><a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$results</span><span class="src-sym">) </span>== <span class="src-num">0</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a253"></a>            <span class="src-var">$sql </span>=     <span class="src-str">&quot; SELECT DISTINCT alarm_trigger_data_field AS id, alarm_trigger_type AS type&quot;</span></li>
<li><a name="a254"></a>                    .<span class="src-str">&quot; FROM sys_definition_alarm_&quot;</span>.<span class="src-var">$type</span></li>
<li><a name="a255"></a>                    .<span class="src-str">&quot; WHERE alarm_id = &quot;</span>.<span class="src-var">$alarm_id</span>.<span class="src-str">&quot; AND family = '&quot;</span>.<span class="src-var">$family</span>.<span class="src-str">&quot;'&quot;</span></li>
<li><a name="a256"></a>                    .<span class="src-str">&quot; AND alarm_trigger_data_field IS NOT NULL&quot;</span><span class="src-sym">;</span><span class="src-comm">// AND on_off = 1&quot;;</span></li>
<li><a name="a257"></a>            </li>
<li><a name="a258"></a>            <span class="src-var">$req </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a259"></a>            <span class="src-var">$results </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">getQueryResults</span><span class="src-sym">(</span><span class="src-var">$req</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a260"></a>        <span class="src-sym">}</span></li>
<li><a name="a261"></a>&nbsp;</li>
<li><a name="a262"></a>        <span class="src-key">return </span><span class="src-var">$results</span><span class="src-sym">;    </span></li>
<li><a name="a263"></a>    <span class="src-sym">}</span></li>
<li><a name="a264"></a>    </li>
<li><a name="a265"></a>    <span class="src-doc">/**</span></li>
<li><a name="a266"></a><span class="src-doc">     * Retourne les agregations reseaux d'une famille de l'application</span></li>
<li><a name="a267"></a><span class="src-doc">     *</span></li>
<li><a name="a268"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$family </span><span class="src-doc">famille des na recherchées</span></li>
<li><a name="a269"></a><span class="src-doc">      * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">la liste des na de la famille</span></li>
<li><a name="a270"></a><span class="src-doc">     */</span></li>
<li><a name="a271"></a>&nbsp;</li>
<li><a name="a272"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetNetworkAgregation">getNetworkAgregation</a><span class="src-sym">(</span><span class="src-var">$family</span><span class="src-sym">)</span></li>
<li><a name="a273"></a>    <span class="src-sym">{</span></li>
<li><a name="a274"></a>        <span class="src-comm">/*$sql = &quot;SELECT DISTINCT agregation, agregation_label FROM sys_definition_network_agregation WHERE family = '&quot;.$family.&quot;' ORDER BY agregation_rank DESC&quot;;</span></li>
<li><a name="a275"></a><span class="src-comm">        $req = $this-&gt;db_connection-&gt;executeQuery($sql);</span></li>
<li><a name="a276"></a><span class="src-comm">        return $this-&gt;db_connection-&gt;getQueryResults($req);*/</span></li>
<li><a name="a277"></a>&nbsp;</li>
<li><a name="a278"></a>        <span class="src-key">return </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'agregation'</span>=&gt;<span class="src-str">'Global'</span><span class="src-sym">, </span><span class="src-str">'agregation_label'</span>=&gt;<span class="src-str">'Global'</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'agregation'</span>=&gt;<span class="src-str">'Account'</span><span class="src-sym">, </span><span class="src-str">'agregation_label'</span>=&gt;<span class="src-str">'Account'</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'agregation'</span>=&gt;<span class="src-str">'Sub-account'</span><span class="src-sym">, </span><span class="src-str">'agregation_label'</span>=&gt;<span class="src-str">'Sub-account'</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a279"></a>    <span class="src-sym">}</span></li>
<li><a name="a280"></a>    </li>
<li><a name="a281"></a>    <span class="src-doc">/**</span></li>
<li><a name="a282"></a><span class="src-doc">     * Retourne les agregations temporelles de l'application</span></li>
<li><a name="a283"></a><span class="src-doc">     *</span></li>
<li><a name="a284"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">la liste des agregations temporelles de l'application</span></li>
<li><a name="a285"></a><span class="src-doc">     */</span></li>
<li><a name="a286"></a>&nbsp;</li>
<li><a name="a287"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetTimeAgregation">getTimeAgregation</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a288"></a>    <span class="src-sym">{</span></li>
<li><a name="a289"></a>        <span class="src-comm">/*$sql = &quot;SELECT DISTINCT agregation, agregation_label FROM sys_definition_time_agregation ORDER BY agregation_rank ASC&quot;;</span></li>
<li><a name="a290"></a><span class="src-comm">        $req = $this-&gt;db_connection-&gt;executeQuery($sql);</span></li>
<li><a name="a291"></a><span class="src-comm">        return $this-&gt;db_connection-&gt;getQueryResults($req);*/</span></li>
<li><a name="a292"></a>&nbsp;</li>
<li><a name="a293"></a>        <span class="src-key">return </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'agregation'</span>=&gt;<span class="src-str">'day'</span><span class="src-sym">, </span><span class="src-str">'agregation_label'</span>=&gt;<span class="src-str">'Day'</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'agregation'</span>=&gt;<span class="src-str">'week'</span><span class="src-sym">, </span><span class="src-str">'agregation_label'</span>=&gt;<span class="src-str">'Week'</span><span class="src-sym">)</span><span class="src-sym">, </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'agregation'</span>=&gt;<span class="src-str">'month'</span><span class="src-sym">, </span><span class="src-str">'agregation_label'</span>=&gt;<span class="src-str">'Month'</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a294"></a>    <span class="src-sym">}</span></li>
<li><a name="a295"></a>&nbsp;</li>
<li><a name="a296"></a>    <span class="src-doc">/**</span></li>
<li><a name="a297"></a><span class="src-doc">     * Retourne le libellé d'une na sélectionnée</span></li>
<li><a name="a298"></a><span class="src-doc">     *</span></li>
<li><a name="a299"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$na </span><span class="src-doc">nom de la na</span></li>
<li><a name="a300"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$family </span><span class="src-doc">famille de la na</span></li>
<li><a name="a301"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">libellé de la na sélectionnée</span></li>
<li><a name="a302"></a><span class="src-doc">     */</span></li>
<li><a name="a303"></a>    </li>
<li><a name="a304"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetNALabel">getNALabel</a><span class="src-sym">(</span><span class="src-var">$na</span><span class="src-sym">, </span><span class="src-var">$family</span><span class="src-sym">)</span></li>
<li><a name="a305"></a>    <span class="src-sym">{</span></li>
<li><a name="a306"></a>        <span class="src-comm">/*$sql = &quot;SELECT agregation_label FROM sys_definition_network_agregation WHERE agregation = '&quot;.$na.&quot;' AND family = '&quot;.$family.&quot;'&quot;;</span></li>
<li><a name="a307"></a><span class="src-comm">        $req = $this-&gt;db_connection-&gt;executeQuery($sql);</span></li>
<li><a name="a308"></a><span class="src-comm">        return $this-&gt;db_connection-&gt;getQueryResults($req, &quot;one&quot;);*/</span></li>
<li><a name="a309"></a>&nbsp;</li>
<li><a name="a310"></a>        <span class="src-key">return </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'agregation_label' </span>=&gt; <span class="src-var">$na</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a311"></a>    <span class="src-sym">}</span></li>
<li><a name="a312"></a>&nbsp;</li>
<li><a name="a313"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetTALabel">getTALabel</a><span class="src-sym">(</span><span class="src-var">$ta</span><span class="src-sym">)</span></li>
<li><a name="a314"></a>    <span class="src-sym">{</span></li>
<li><a name="a315"></a>        <span class="src-comm">/*$sql = &quot;SELECT agregation_label FROM sys_definition_time_agregation WHERE agregation = '&quot;.$ta.&quot;'&quot;;</span></li>
<li><a name="a316"></a><span class="src-comm">        $req = $this-&gt;db_connection-&gt;executeQuery($sql);</span></li>
<li><a name="a317"></a><span class="src-comm">        return $this-&gt;db_connection-&gt;getQueryResults($req, &quot;one&quot;);*/</span></li>
<li><a name="a318"></a>&nbsp;</li>
<li><a name="a319"></a>        <span class="src-key">return </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'agregation_label' </span>=&gt; <a href="http://www.php.net/ucfirst">ucfirst</a><span class="src-sym">(</span><span class="src-var">$ta</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a320"></a>    <span class="src-sym">}</span></li>
<li><a name="a321"></a>    </li>
<li><a name="a322"></a>    <span class="src-doc">/**</span></li>
<li><a name="a323"></a><span class="src-doc">     * Permet de supprimer une alarme de la BD de l'application</span></li>
<li><a name="a324"></a><span class="src-doc">     *</span></li>
<li><a name="a325"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">integer </span><span class="src-doc-var">$alarm_id </span><span class="src-doc">identifiant de l'alarme</span></li>
<li><a name="a326"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$alarm_type </span><span class="src-doc">type de l'alarme</span></li>
<li><a name="a327"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$alarm_family </span><span class="src-doc">famille de l'alarme</span></li>
<li><a name="a328"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$alarm_ta </span><span class="src-doc">valeur de la ta de l'alarme</span></li>
<li><a name="a329"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">boolean </span><span class="src-doc">etat de la suppression de l'alarme dans la BD</span></li>
<li><a name="a330"></a><span class="src-doc">     */</span></li>
<li><a name="a331"></a>&nbsp;</li>
<li><a name="a332"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methoddropAlarm">dropAlarm</a><span class="src-sym">(</span><span class="src-var">$alarm_id</span><span class="src-sym">, </span><span class="src-var">$alarm_type</span><span class="src-sym">, </span><span class="src-var">$alarm_family</span><span class="src-sym">, </span><span class="src-var">$alarm_ta</span><span class="src-sym">, </span><span class="src-var">$del_sender </span>= <span class="src-id">true</span><span class="src-sym">)</span></li>
<li><a name="a333"></a>    <span class="src-sym">{</span></li>
<li><a name="a334"></a>        <span class="src-var">$deletion_state </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a335"></a>        </li>
<li><a name="a336"></a>        <span class="src-comm">// Suppression des lignes de la table 'sys_alarm_email_sender' relatives à l'envoi des mails</span></li>
<li><a name="a337"></a>        </li>
<li><a name="a338"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$del_sender</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a339"></a>            <span class="src-var">$sql </span>= <span class="src-str">&quot;DELETE FROM sys_alarm_email_sender WHERE id_alarm = &quot;</span>.<span class="src-var">$alarm_id</span>.<span class="src-str">&quot; AND time_aggregation = '&quot;</span>.<span class="src-var">$alarm_ta</span>.<span class="src-str">&quot;' AND alarm_type = 'alarm_&quot;</span>.<span class="src-var">$alarm_type</span>.<span class="src-str">&quot;'&quot;</span><span class="src-sym">;</span></li>
<li><a name="a340"></a>            <span class="src-var">$deletion_state </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;            </span></li>
<li><a name="a341"></a>        <span class="src-sym">}</span></li>
<li><a name="a342"></a>&nbsp;</li>
<li><a name="a343"></a>        <span class="src-comm">// Suppression des valeurs de na de l'alarme définies dans la table 'sys_definition_alarm_network_elements'</span></li>
<li><a name="a344"></a>&nbsp;</li>
<li><a name="a345"></a>        <span class="src-var">$sql </span>= <span class="src-str">&quot;DELETE FROM sys_definition_alarm_network_elements WHERE id_alarm = &quot;</span>.<span class="src-var">$alarm_id</span>.<span class="src-str">&quot; AND type_alarm = 'alarm_&quot;</span>.<span class="src-var">$alarm_type</span>.<span class="src-str">&quot;'&quot;</span><span class="src-sym">;</span></li>
<li><a name="a346"></a>        <span class="src-var">$deletion_state </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a347"></a>        </li>
<li><a name="a348"></a>        <span class="src-comm">// Suppression de la définition de l'alarme</span></li>
<li><a name="a349"></a>&nbsp;</li>
<li><a name="a350"></a>        <span class="src-var">$sql </span>= <span class="src-str">&quot;DELETE FROM sys_definition_alarm_&quot;</span>.<span class="src-var">$alarm_type</span>.<span class="src-str">&quot; WHERE alarm_id = &quot;</span>.<span class="src-var">$alarm_id</span>.<span class="src-str">&quot; AND family = '&quot;</span>.<span class="src-var">$alarm_family</span>.<span class="src-str">&quot;'&quot;</span><span class="src-sym">;</span></li>
<li><a name="a351"></a>        <span class="src-var">$deletion_state </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a352"></a>&nbsp;</li>
<li><a name="a353"></a>        <span class="src-key">return </span><span class="src-var">$deletion_state</span><span class="src-sym">;</span></li>
<li><a name="a354"></a>    <span class="src-sym">}</span></li>
<li><a name="a355"></a>    </li>
<li><a name="a356"></a>    <span class="src-doc">/**</span></li>
<li><a name="a357"></a><span class="src-doc">     * Retourne les niveaux de criticité existants dans l'application</span></li>
<li><a name="a358"></a><span class="src-doc">     *</span></li>
<li><a name="a359"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">la </span><span class="src-doc">liste des niveaux de criticité</span></li>
<li><a name="a360"></a><span class="src-doc">     */</span></li>
<li><a name="a361"></a>&nbsp;</li>
<li><a name="a362"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetCriticityLevels">getCriticityLevels</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a363"></a>    <span class="src-sym">{</span></li>
<li><a name="a364"></a>        <span class="src-comm">// Note : recupérer les couleurs via une requete en base</span></li>
<li><a name="a365"></a>        </li>
<li><a name="a366"></a>        <span class="src-comm">/*return array(    </span></li>
<li><a name="a367"></a><span class="src-comm">                        array('id'=&gt;&quot;critical&quot;, 'label'=&gt;&quot;Critical&quot;, 'color'=&gt;&quot;#FF0000&quot;),</span></li>
<li><a name="a368"></a><span class="src-comm">                        array('id'=&gt;&quot;major&quot;, 'label'=&gt;&quot;Major&quot;, 'color'=&gt;&quot;#FAB308&quot;),</span></li>
<li><a name="a369"></a><span class="src-comm">                        array('id'=&gt;&quot;minor&quot;, 'label'=&gt;&quot;Minor&quot;, 'color'=&gt;&quot;#F7FA08&quot;)</span></li>
<li><a name="a370"></a><span class="src-comm">                    );*/</span></li>
<li><a name="a371"></a>&nbsp;</li>
<li><a name="a372"></a>        <span class="src-key">return </span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'id'</span>=&gt;<span class="src-str">&quot;critical&quot;</span><span class="src-sym">, </span><span class="src-str">'label'</span>=&gt;<span class="src-str">&quot;&quot;</span><span class="src-sym">, </span><span class="src-str">'color'</span>=&gt;<span class="src-str">&quot;&quot;</span><span class="src-sym">)))</span><span class="src-sym">;</span></li>
<li><a name="a373"></a>    <span class="src-sym">}</span></li>
<li><a name="a374"></a>    </li>
<li><a name="a375"></a>    <span class="src-doc">/**</span></li>
<li><a name="a376"></a><span class="src-doc">     * Retourne les opérandes des triggers disponbiles dans l'application</span></li>
<li><a name="a377"></a><span class="src-doc">     *</span></li>
<li><a name="a378"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">la liste des opérandes disponibles</span></li>
<li><a name="a379"></a><span class="src-doc">     */</span></li>
<li><a name="a380"></a>&nbsp;</li>
<li><a name="a381"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetTriggerOperands">getTriggerOperands</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a382"></a>    <span class="src-sym">{</span></li>
<li><a name="a383"></a>        <span class="src-comm">//return array('none', '=', '&lt;=', '&gt;=', '&lt;', '&gt;');</span></li>
<li><a name="a384"></a>&nbsp;</li>
<li><a name="a385"></a>        <span class="src-key">return </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'='</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a386"></a>    <span class="src-sym">}</span></li>
<li><a name="a387"></a>    </li>
<li><a name="a388"></a>    <span class="src-doc">/**</span></li>
<li><a name="a389"></a><span class="src-doc">     * Retourne les types de triggers disponibles dans l'application</span></li>
<li><a name="a390"></a><span class="src-doc">     *</span></li>
<li><a name="a391"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">la </span><span class="src-doc">liste des types de triggers disponibles</span></li>
<li><a name="a392"></a><span class="src-doc">     */</span></li>
<li><a name="a393"></a>&nbsp;</li>
<li><a name="a394"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetTriggerTypes">getTriggerTypes</a><span class="src-sym">(</span><span class="src-sym">)</span></li>
<li><a name="a395"></a>    <span class="src-sym">{</span></li>
<li><a name="a396"></a>        <span class="src-comm">//return array(array('id'=&gt;&quot;kpi&quot;, 'label'=&gt;&quot;KPI&quot;), array('id'=&gt;&quot;raw&quot;, 'label'=&gt;&quot;Raw Counter&quot;));</span></li>
<li><a name="a397"></a>&nbsp;</li>
<li><a name="a398"></a>        <span class="src-key">return </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'id'</span>=&gt;<span class="src-str">&quot;qos&quot;</span><span class="src-sym">, </span><span class="src-str">'label'</span>=&gt;<span class="src-str">&quot;Qos&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a399"></a>    <span class="src-sym">}</span></li>
<li><a name="a400"></a>    </li>
<li><a name="a401"></a>    <span class="src-doc">/**</span></li>
<li><a name="a402"></a><span class="src-doc">     * Retourne la liste des valeurs d'un type de trigger sélectionné</span></li>
<li><a name="a403"></a><span class="src-doc">     *</span></li>
<li><a name="a404"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$family </span><span class="src-doc">famille auquel appartient le type</span></li>
<li><a name="a405"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$type </span><span class="src-doc">nom du type</span></li>
<li><a name="a406"></a><span class="src-doc">      * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">liste des valeurs du type de triggers</span></li>
<li><a name="a407"></a><span class="src-doc">     */</span></li>
<li><a name="a408"></a>&nbsp;</li>
<li><a name="a409"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetTriggerTypeValues">getTriggerTypeValues</a><span class="src-sym">(</span><span class="src-var">$family</span><span class="src-sym">, </span><span class="src-var">$type </span>= <span class="src-str">''</span><span class="src-sym">)</span></li>
<li><a name="a410"></a>    <span class="src-sym">{</span></li>
<li><a name="a411"></a>        <span class="src-var">$type_values </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a412"></a>&nbsp;</li>
<li><a name="a413"></a>        <span class="src-comm">/*$raws = $this-&gt;getRaws($family);</span></li>
<li><a name="a414"></a>&nbsp;</li>
<li><a name="a415"></a><span class="src-comm">        for ($i=0; $i &lt; count($raws); $i++) {</span></li>
<li><a name="a416"></a><span class="src-comm">            $type_values['raw'][$raws[$i]['id']] = array('label' =&gt; $raws[$i]['label'], 'label_complete' =&gt; $raws[$i]['label_complete']);</span></li>
<li><a name="a417"></a><span class="src-comm">        }</span></li>
<li><a name="a418"></a>&nbsp;</li>
<li><a name="a419"></a><span class="src-comm">        $kpis = $this-&gt;getKpis($family);</span></li>
<li><a name="a420"></a>&nbsp;</li>
<li><a name="a421"></a><span class="src-comm">        for ($i=0; $i &lt; count($kpis); $i++) {</span></li>
<li><a name="a422"></a><span class="src-comm">            $type_values['kpi'][$kpis[$i]['id']] = array('label' =&gt; $kpis[$i]['label'], 'label_complete' =&gt; $kpis[$i]['label_complete']);</span></li>
<li><a name="a423"></a><span class="src-comm">        }*/</span></li>
<li><a name="a424"></a>&nbsp;</li>
<li><a name="a425"></a>        <span class="src-var">$qos </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#methodgetKpis">getKpis</a><span class="src-sym">(</span><span class="src-var">$family</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a426"></a>&nbsp;</li>
<li><a name="a427"></a>        <span class="src-key">for </span><span class="src-sym">(</span><span class="src-var">$i</span>=<span class="src-num">0</span><span class="src-sym">; </span><span class="src-var">$i </span>&lt; <a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$qos</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-var">$i</span>++<span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a428"></a>            <span class="src-var">$type_values</span><span class="src-sym">[</span><span class="src-str">'qos'</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-var">$qos</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'ID'</span><span class="src-sym">]] </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'label' </span>=&gt; <span class="src-var">$qos</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'NAME'</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-str">'label_complete' </span>=&gt; <span class="src-var">$qos</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">'NAME'</span><span class="src-sym">]</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a429"></a>        <span class="src-sym">}</span></li>
<li><a name="a430"></a>&nbsp;</li>
<li><a name="a431"></a>        <span class="src-key">return </span><span class="src-var">$type_values</span><span class="src-sym">;</span></li>
<li><a name="a432"></a>    <span class="src-sym">}</span></li>
<li><a name="a433"></a>    </li>
<li><a name="a434"></a>    <span class="src-doc">/**</span></li>
<li><a name="a435"></a><span class="src-doc">     * Retourne la liste des valeurs de type &quot;raw&quot;</span></li>
<li><a name="a436"></a><span class="src-doc">     *</span></li>
<li><a name="a437"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$family </span><span class="src-doc">famille auquelles appartiennent les valeurs de type &quot;raw&quot;</span></li>
<li><a name="a438"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">la liste des valeurs du type &quot;raw&quot;</span></li>
<li><a name="a439"></a><span class="src-doc">     */</span></li>
<li><a name="a440"></a>&nbsp;</li>
<li><a name="a441"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetRaws">getRaws</a><span class="src-sym">(</span><span class="src-var">$family</span><span class="src-sym">)</span></li>
<li><a name="a442"></a>    <span class="src-sym">{</span></li>
<li><a name="a443"></a>        <span class="src-var">$sql </span>=     <span class="src-str">&quot; SELECT DISTINCT edw_field_name AS id, edw_field_name_label AS label_complete,&quot;</span></li>
<li><a name="a444"></a>                .<span class="src-str">&quot; CASE WHEN (LENGTH(edw_field_name_label) &gt; 52) THEN CONCAT(SUBSTRING(edw_field_name_label,1,52), '...') ELSE edw_field_name_label END AS label&quot;</span></li>
<li><a name="a445"></a>                .<span class="src-str">&quot; FROM sys_field_reference&quot;</span></li>
<li><a name="a446"></a>                .<span class="src-str">&quot; WHERE edw_group_table = (SELECT edw_group_table FROM sys_definition_group_table WHERE family = '&quot;</span>.<span class="src-var">$family</span>.<span class="src-str">&quot;')&quot;</span></li>
<li><a name="a447"></a>                .<span class="src-str">&quot; AND visible = 1 ORDER BY edw_field_name_label ASC&quot;</span><span class="src-sym">;</span></li>
<li><a name="a448"></a>&nbsp;</li>
<li><a name="a449"></a>        <span class="src-var">$req </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a450"></a>        <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">getQueryResults</span><span class="src-sym">(</span><span class="src-var">$req</span><span class="src-sym">)</span><span class="src-sym">;        </span></li>
<li><a name="a451"></a>    <span class="src-sym">}</span></li>
<li><a name="a452"></a>    </li>
<li><a name="a453"></a>&nbsp;</li>
<li><a name="a454"></a>    <span class="src-doc">/**</span></li>
<li><a name="a455"></a><span class="src-doc">     * Retourne la liste des valeurs de type &quot;kpi&quot;</span></li>
<li><a name="a456"></a><span class="src-doc">     *</span></li>
<li><a name="a457"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$family </span><span class="src-doc">famille auquelles appartiennent les valeurs de type &quot;kpi&quot;</span></li>
<li><a name="a458"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">la liste des valeurs du type &quot;kpi&quot;</span></li>
<li><a name="a459"></a><span class="src-doc">     */    </span></li>
<li><a name="a460"></a>&nbsp;</li>
<li><a name="a461"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetKpis">getKpis</a><span class="src-sym">(</span><span class="src-var">$family</span><span class="src-sym">)</span></li>
<li><a name="a462"></a>    <span class="src-sym">{</span></li>
<li><a name="a463"></a>        <span class="src-comm">/*$sql =     &quot; SELECT DISTINCT kpi_name AS id, kpi_label AS label_complete,&quot;</span></li>
<li><a name="a464"></a><span class="src-comm">                .&quot; CASE WHEN (LENGTH(kpi_label) &gt; 52) THEN CONCAT(SUBSTRING(kpi_label,1,52), '...') ELSE kpi_label END AS label&quot;</span></li>
<li><a name="a465"></a><span class="src-comm">                .&quot; FROM sys_definition_kpi&quot;</span></li>
<li><a name="a466"></a><span class="src-comm">                .&quot; WHERE edw_group_table = (SELECT edw_group_table FROM sys_definition_group_table WHERE family = '&quot;.$family.&quot;')&quot;</span></li>
<li><a name="a467"></a><span class="src-comm">                .&quot; AND on_off = 1 AND visible = 1 ORDER BY kpi_label ASC&quot;;*/</span></li>
<li><a name="a468"></a>&nbsp;</li>
<li><a name="a469"></a>        <span class="src-comm">/*$sql = 'SELECT ID AS id, NAME AS label_complete, CASE WHEN (LENGTH(NAME) &gt; 52) THEN CONCAT(SUBSTRING(NAME,1,52), \'...\') ELSE NAME END AS label</span></li>
<li><a name="a470"></a><span class="src-comm">        FROM</span></li>
<li><a name="a471"></a><span class="src-comm">            (</span></li>
<li><a name="a472"></a><span class="src-comm">            SELECT</span></li>
<li><a name="a473"></a><span class="src-comm">                s1.ASRV_ID AS ID,</span></li>
<li><a name="a474"></a><span class="src-comm">                CONCAT(</span></li>
<li><a name="a475"></a><span class="src-comm">                    IF(s4.ASRV_SHORT_NAME IS NULL,&quot;&quot;,CONCAT(s4.ASRV_SHORT_NAME,&quot;/&quot;)),</span></li>
<li><a name="a476"></a><span class="src-comm">                    IF(s3.ASRV_SHORT_NAME IS NULL,&quot;&quot;,CONCAT(s3.ASRV_SHORT_NAME,&quot;/&quot;)),</span></li>
<li><a name="a477"></a><span class="src-comm">                    IF(s2.ASRV_SHORT_NAME IS NULL,&quot;&quot;,CONCAT(s2.ASRV_SHORT_NAME,&quot;/&quot;)),</span></li>
<li><a name="a478"></a><span class="src-comm">                    s1.ASRV_SHORT_NAME</span></li>
<li><a name="a479"></a><span class="src-comm">                    ) AS NAME,</span></li>
<li><a name="a480"></a><span class="src-comm">        CONCAT(</span></li>
<li><a name="a481"></a><span class="src-comm">            IFNULL(s4.ASRV_ROW,&quot;&quot;),</span></li>
<li><a name="a482"></a><span class="src-comm">            IFNULL(s3.ASRV_ROW,&quot;&quot;),</span></li>
<li><a name="a483"></a><span class="src-comm">            IFNULL(s2.ASRV_ROW,&quot;&quot;),</span></li>
<li><a name="a484"></a><span class="src-comm">            IFNULL(s1.ASRV_ROW,&quot;&quot;)) AS NORDER</span></li>
<li><a name="a485"></a><span class="src-comm">            FROM</span></li>
<li><a name="a486"></a><span class="src-comm">                alk_service s1</span></li>
<li><a name="a487"></a><span class="src-comm">                LEFT JOIN alk_service s2 ON (s1.ASRV_PARENT = s2.ASRV_ID)</span></li>
<li><a name="a488"></a><span class="src-comm">                LEFT JOIN alk_service s3 ON (s2.ASRV_PARENT = s3.ASRV_ID)</span></li>
<li><a name="a489"></a><span class="src-comm">                LEFT JOIN alk_service s4 ON (s3.ASRV_PARENT = s4.ASRV_ID)</span></li>
<li><a name="a490"></a><span class="src-comm">            -- WHERE s1.ASRV_LEVEL = 4 -- POSSIBILITE DE NE PRENDRE QU\'UN SEUL NIVEAU</span></li>
<li><a name="a491"></a><span class="src-comm">            ORDER BY NORDER</span></li>
<li><a name="a492"></a><span class="src-comm">            )sr;';*/</span></li>
<li><a name="a493"></a>&nbsp;</li>
<li><a name="a494"></a>            <span class="src-var">$sql </span>= <span class="src-str">'SELECT ID, NAME</span></li>
<li><a name="a495"></a><span class="src-str">            FROM</span></li>
<li><a name="a496"></a><span class="src-str">                (</span></li>
<li><a name="a497"></a><span class="src-str">                SELECT</span></li>
<li><a name="a498"></a><span class="src-str">                    s1.ASRV_ID AS ID,</span></li>
<li><a name="a499"></a><span class="src-str">                    CONCAT(</span></li>
<li><a name="a500"></a><span class="src-str">                        IF(s4.ASRV_SHORT_NAME IS NULL,&quot;&quot;,CONCAT(s4.ASRV_SHORT_NAME,&quot;/&quot;)),</span></li>
<li><a name="a501"></a><span class="src-str">                        IF(s3.ASRV_SHORT_NAME IS NULL,&quot;&quot;,CONCAT(s3.ASRV_SHORT_NAME,&quot;/&quot;)),</span></li>
<li><a name="a502"></a><span class="src-str">                        IF(s2.ASRV_SHORT_NAME IS NULL,&quot;&quot;,CONCAT(s2.ASRV_SHORT_NAME,&quot;/&quot;)),</span></li>
<li><a name="a503"></a><span class="src-str">                        s1.ASRV_SHORT_NAME</span></li>
<li><a name="a504"></a><span class="src-str">                        ) AS NAME,</span></li>
<li><a name="a505"></a><span class="src-str">            CONCAT(</span></li>
<li><a name="a506"></a><span class="src-str">                IFNULL(s4.ASRV_ROW,&quot;&quot;),</span></li>
<li><a name="a507"></a><span class="src-str">                IFNULL(s3.ASRV_ROW,&quot;&quot;),</span></li>
<li><a name="a508"></a><span class="src-str">                IFNULL(s2.ASRV_ROW,&quot;&quot;),</span></li>
<li><a name="a509"></a><span class="src-str">                IFNULL(s1.ASRV_ROW,&quot;&quot;)) AS NORDER</span></li>
<li><a name="a510"></a><span class="src-str">                FROM</span></li>
<li><a name="a511"></a><span class="src-str">                    alk_service s1</span></li>
<li><a name="a512"></a><span class="src-str">                    LEFT JOIN alk_service s2 ON (s1.ASRV_PARENT = s2.ASRV_ID)</span></li>
<li><a name="a513"></a><span class="src-str">                    LEFT JOIN alk_service s3 ON (s2.ASRV_PARENT = s3.ASRV_ID)</span></li>
<li><a name="a514"></a><span class="src-str">                    LEFT JOIN alk_service s4 ON (s3.ASRV_PARENT = s4.ASRV_ID)</span></li>
<li><a name="a515"></a><span class="src-str">                -- WHERE s1.ASRV_LEVEL = 4 -- POSSIBILITE DE NE PRENDRE QU\'UN SEUL NIVEAU</span></li>
<li><a name="a516"></a><span class="src-str">                -- WHERE s1.ASRV_ENABLED!=0</span></li>
<li><a name="a517"></a><span class="src-str">                ORDER BY NORDER</span></li>
<li><a name="a518"></a><span class="src-str">                )sr;'</span><span class="src-sym">;</span></li>
<li><a name="a519"></a>        </li>
<li><a name="a520"></a>        <span class="src-var">$req </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a521"></a>        <span class="src-key">return </span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">getQueryResults</span><span class="src-sym">(</span><span class="src-var">$req</span><span class="src-sym">)</span><span class="src-sym">;    </span></li>
<li><a name="a522"></a>    <span class="src-sym">}</span></li>
<li><a name="a523"></a>    </li>
<li><a name="a524"></a>    <span class="src-doc">/**</span></li>
<li><a name="a525"></a><span class="src-doc">     * Retourne les valeurs des na (appelées également ne) d'une famille</span></li>
<li><a name="a526"></a><span class="src-doc">     *</span></li>
<li><a name="a527"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$na </span><span class="src-doc">nom de la na sélectionnée</span></li>
<li><a name="a528"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$family </span><span class="src-doc">famille de la na</span></li>
<li><a name="a529"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">liste des ne</span></li>
<li><a name="a530"></a><span class="src-doc">     */</span></li>
<li><a name="a531"></a>&nbsp;</li>
<li><a name="a532"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetNE">getNE</a><span class="src-sym">(</span><span class="src-var">$na</span><span class="src-sym">, </span><span class="src-var">$family </span>= <span class="src-str">''</span><span class="src-sym">)</span></li>
<li><a name="a533"></a>    <span class="src-sym">{</span></li>
<li><a name="a534"></a>        <span class="src-comm">// Note : remplacer edw_object_1_ref par une recherche de la table de référence en fonction de la famille dans la BD</span></li>
<li><a name="a535"></a>&nbsp;</li>
<li><a name="a536"></a>        <span class="src-comm">/*$sql =     &quot; SELECT DISTINCT &quot;.$na.&quot; AS id,&quot;</span></li>
<li><a name="a537"></a><span class="src-comm">                .&quot; CASE WHEN &quot;.$na.&quot;_label IS NULL THEN CONCAT('(',&quot;.$na.&quot;,')') ELSE &quot;.$na.&quot;_label END AS label&quot;</span></li>
<li><a name="a538"></a><span class="src-comm">                .&quot; FROM edw_object_1_ref WHERE $na is NOT NULL ORDER BY &quot;.$na;</span></li>
<li><a name="a539"></a>        </li>
<li><a name="a540"></a><span class="src-comm">        $req = $this-&gt;db_connection-&gt;executeQuery($sql);</span></li>
<li><a name="a541"></a><span class="src-comm">        $res = $this-&gt;db_connection-&gt;getQueryResults($req);*/</span></li>
<li><a name="a542"></a>&nbsp;</li>
<li><a name="a543"></a>        <span class="src-key">switch </span><span class="src-sym">(</span><span class="src-var">$na</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a544"></a>            <span class="src-key">case </span><span class="src-str">'Global' </span>:</li>
<li><a name="a545"></a>                </li>
<li><a name="a546"></a>                <span class="src-key">return </span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'id'</span>=&gt;<span class="src-str">&quot;all_&quot;</span>.<span class="src-var">$na</span><span class="src-sym">, </span><span class="src-str">'label' </span>=&gt; <span class="src-str">&quot;All values&quot;</span><span class="src-sym">))</span><span class="src-sym">;</span></li>
<li><a name="a547"></a>&nbsp;</li>
<li><a name="a548"></a>            <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a549"></a>            </li>
<li><a name="a550"></a>            <span class="src-key">case </span><span class="src-str">'Account' </span>:</li>
<li><a name="a551"></a>&nbsp;</li>
<li><a name="a552"></a>                <span class="src-var">$sql </span>=     <span class="src-str">&quot; SELECT grp_group AS id, grp_name AS label&quot;</span></li>
<li><a name="a553"></a>                        .<span class="src-str">&quot; FROM groups&quot;</span></li>
<li><a name="a554"></a>                        .<span class="src-str">&quot; WHERE grp_group!=0 AND grp_subgroup=0&quot;</span></li>
<li><a name="a555"></a>                        <span class="src-comm">//.&quot; AND ( grp_deactivated=\&quot;0000-00-00\&quot; OR grp_deactivated IS NULL ) AND grp_deleted=0&quot;</span></li>
<li><a name="a556"></a>                        .<span class="src-str">&quot; ORDER BY label;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a557"></a>        </li>
<li><a name="a558"></a>                <span class="src-var">$req </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a559"></a>                <span class="src-var">$res </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">getQueryResults</span><span class="src-sym">(</span><span class="src-var">$req</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a560"></a>&nbsp;</li>
<li><a name="a561"></a>            <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a562"></a>&nbsp;</li>
<li><a name="a563"></a>            <span class="src-key">case </span><span class="src-str">'Sub-account' </span>:</li>
<li><a name="a564"></a>&nbsp;</li>
<li><a name="a565"></a>                <span class="src-var">$sql </span>=     <span class="src-str">&quot; SELECT CONCAT(g1.grp_group,\&quot;_\&quot;,g2.grp_subgroup) AS id,&quot;</span></li>
<li><a name="a566"></a>                        .<span class="src-str">&quot; CONCAT(\&quot;[\&quot;,g1.grp_name,\&quot;]\&quot;,g2.grp_name) AS label&quot;</span></li>
<li><a name="a567"></a>                        .<span class="src-str">&quot; FROM groups g1&quot;</span></li>
<li><a name="a568"></a>                        .<span class="src-str">&quot; LEFT JOIN&quot;</span></li>
<li><a name="a569"></a>                        .<span class="src-str">&quot; groups g2 ON (g1.grp_group=g2.grp_group AND g2.grp_subgroup&gt;0)&quot;</span></li>
<li><a name="a570"></a>                        .<span class="src-str">&quot; WHERE g1.grp_group!=0 AND g1.grp_subgroup=0&quot;</span></li>
<li><a name="a571"></a>                        .<span class="src-str">&quot; AND g2.grp_subgroup IS NOT NULL&quot;</span></li>
<li><a name="a572"></a>                        <span class="src-comm">//.&quot; AND ( g2.grp_deactivated=\&quot;0000-00-00\&quot; OR g2.grp_deactivated IS NULL ) AND g2.grp_deleted=0&quot;</span></li>
<li><a name="a573"></a>                        .<span class="src-str">&quot; ORDER BY label;&quot;</span><span class="src-sym">;</span></li>
<li><a name="a574"></a>&nbsp;</li>
<li><a name="a575"></a>                <span class="src-var">$req </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a576"></a>                <span class="src-var">$res </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">getQueryResults</span><span class="src-sym">(</span><span class="src-var">$req</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a577"></a>            </li>
<li><a name="a578"></a>            <span class="src-key">break</span><span class="src-sym">;</span></li>
<li><a name="a579"></a>        <span class="src-sym">}</span></li>
<li><a name="a580"></a>        <span class="src-key">return </span><a href="http://www.php.net/array_merge">array_merge</a><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'id'</span>=&gt;<span class="src-str">&quot;all_&quot;</span>.<span class="src-var">$na</span><span class="src-sym">, </span><span class="src-str">'label' </span>=&gt; <span class="src-str">&quot;All values&quot;</span><span class="src-sym">))</span><span class="src-sym">, </span><span class="src-var">$res</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a581"></a>    <span class="src-sym">}</span></li>
<li><a name="a582"></a>    </li>
<li><a name="a583"></a>    <span class="src-doc">/**</span></li>
<li><a name="a584"></a><span class="src-doc">     * Retourne la liste des ne d'une alarme</span></li>
<li><a name="a585"></a><span class="src-doc">     *</span></li>
<li><a name="a586"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">integer </span><span class="src-doc-var">$alarm_id </span><span class="src-doc">identifiant de l'alarme</span></li>
<li><a name="a587"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$type </span><span class="src-doc">type de l'alarme</span></li>
<li><a name="a588"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">array </span><span class="src-doc">liste des ne de l'alarme</span></li>
<li><a name="a589"></a><span class="src-doc">     */</span></li>
<li><a name="a590"></a>&nbsp;</li>
<li><a name="a591"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodgetAlarmNetworkElements">getAlarmNetworkElements</a><span class="src-sym">(</span><span class="src-var">$alarm_id</span><span class="src-sym">, </span><span class="src-var">$type </span>= <span class="src-str">'static'</span><span class="src-sym">)</span></li>
<li><a name="a592"></a>    <span class="src-sym">{</span></li>
<li><a name="a593"></a>        <span class="src-var">$sql </span>= <span class="src-str">&quot;SELECT * FROM sys_definition_alarm_network_elements WHERE id_alarm = &quot;</span>.<span class="src-var">$alarm_id</span>.<span class="src-str">&quot; AND type_alarm = 'alarm_&quot;</span>.<span class="src-var">$type</span>.<span class="src-str">&quot;'&quot;</span><span class="src-sym">;</span></li>
<li><a name="a594"></a>        <span class="src-var">$req </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;        </span></li>
<li><a name="a595"></a>        <span class="src-var">$res </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">getQueryResults</span><span class="src-sym">(</span><span class="src-var">$req</span><span class="src-sym">, </span><span class="src-str">&quot;one&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a596"></a>        </li>
<li><a name="a597"></a>        <span class="src-key">return </span><span class="src-var">$res</span><span class="src-sym">;</span></li>
<li><a name="a598"></a>    <span class="src-sym">}</span></li>
<li><a name="a599"></a>    </li>
<li><a name="a600"></a>    <span class="src-doc">/**</span></li>
<li><a name="a601"></a><span class="src-doc">     * Sauvegarde de la définition d'une alarme dans la BD de l'application</span></li>
<li><a name="a602"></a><span class="src-doc">     *</span></li>
<li><a name="a603"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">integer </span><span class="src-doc-var">$a_id </span><span class="src-doc">identifiant de l'alarme</span></li>
<li><a name="a604"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$a_type </span><span class="src-doc">type de l'alarme</span></li>
<li><a name="a605"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$a_family </span><span class="src-doc">famille de l'alarme</span></li>
<li><a name="a606"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$a_name </span><span class="src-doc">nom de l'alarme</span></li>
<li><a name="a607"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$a_desc </span><span class="src-doc">description de l'alarme</span></li>
<li><a name="a608"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$a_na </span><span class="src-doc">agregation réseau de l'alarme</span></li>
<li><a name="a609"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">array </span><span class="src-doc-var">$a_ne </span><span class="src-doc">liste des ne définies pour l'alarme</span></li>
<li><a name="a610"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$a_ta </span><span class="src-doc">agregation temporelle de l'alarme</span></li>
<li><a name="a611"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">boolean </span><span class="src-doc-var">$a_activate </span><span class="src-doc">état de l'activation de l'alarme</span></li>
<li><a name="a612"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">array </span><span class="src-doc-var">$a_triggers </span><span class="src-doc">liste des triggers de l'alarme</span></li>
<li><a name="a613"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">array </span><span class="src-doc-var">$a_additionnals </span><span class="src-doc">liste des champs additionnels de l'alarme</span></li>
<li><a name="a614"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">boolean </span><span class="src-doc">état de l'insertion de l'alarme dans la BD</span></li>
<li><a name="a615"></a><span class="src-doc">     */</span></li>
<li><a name="a616"></a>&nbsp;</li>
<li><a name="a617"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodsaveAlarmDefinition">saveAlarmDefinition</a><span class="src-sym">(</span><span class="src-var">$a_id</span><span class="src-sym">, </span><span class="src-var">$a_type</span><span class="src-sym">, </span><span class="src-var">$a_family</span><span class="src-sym">, </span><span class="src-var">$a_name</span><span class="src-sym">, </span><span class="src-var">$a_desc</span><span class="src-sym">, </span><span class="src-var">$a_na</span><span class="src-sym">, </span><span class="src-var">$a_ne</span><span class="src-sym">, </span><span class="src-var">$a_ta</span><span class="src-sym">, </span><span class="src-var">$a_activate</span><span class="src-sym">, </span><span class="src-var">$a_triggers</span><span class="src-sym">, </span><span class="src-var">$a_additionnals </span>= <span class="src-key">array</span><span class="src-sym">(</span><span class="src-sym">))</span></li>
<li><a name="a618"></a>    <span class="src-sym">{</span></li>
<li><a name="a619"></a>        <span class="src-comm">// Si l'alarme est déja défini, on la supprime avant de la recréer avec ses nouvelles caractéristiques</span></li>
<li><a name="a620"></a>&nbsp;</li>
<li><a name="a621"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$a_id </span>!= <span class="src-str">''</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a622"></a>            <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#methoddropAlarm">dropAlarm</a><span class="src-sym">(</span><span class="src-var">$a_id</span><span class="src-sym">, </span><span class="src-var">$a_type</span><span class="src-sym">, </span><span class="src-var">$a_family</span><span class="src-sym">, </span><span class="src-var">$a_ta</span><span class="src-sym">, </span><span class="src-id">false</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a623"></a>        <span class="src-sym">}</span></li>
<li><a name="a624"></a>        <span class="src-key">else </span><span class="src-comm">// Sinon, on définit un identifiant pour la nouvelle alarme</span></li>
<li><a name="a625"></a>        <span class="src-sym">{</span></li>
<li><a name="a626"></a>            <span class="src-var">$sql </span>= <span class="src-str">&quot;SELECT MAX(alarm_id)+1 AS alarm_id FROM sys_definition_alarm_&quot;</span>.<span class="src-var">$a_type</span><span class="src-sym">;</span></li>
<li><a name="a627"></a>            <span class="src-var">$req </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a628"></a>            <span class="src-var">$res </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">getQueryResults</span><span class="src-sym">(</span><span class="src-var">$req</span><span class="src-sym">, </span><span class="src-str">&quot;one&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a629"></a>&nbsp;</li>
<li><a name="a630"></a>            <span class="src-var">$a_id </span>= <span class="src-sym">(</span><span class="src-var">$res</span><span class="src-sym">[</span><span class="src-str">'alarm_id'</span><span class="src-sym">] </span>!= <span class="src-str">&quot;&quot;</span><span class="src-sym">) </span>? <span class="src-var">$res</span><span class="src-sym">[</span><span class="src-str">'alarm_id'</span><span class="src-sym">] </span>: <span class="src-num">1</span><span class="src-sym">;</span></li>
<li><a name="a631"></a>        <span class="src-sym">}</span></li>
<li><a name="a632"></a>&nbsp;</li>
<li><a name="a633"></a>        <span class="src-comm">// (Re)Creation de l'alarme</span></li>
<li><a name="a634"></a>&nbsp;</li>
<li><a name="a635"></a>        <span class="src-var">$creation_state </span>= <span class="src-id">false</span><span class="src-sym">;</span></li>
<li><a name="a636"></a>&nbsp;</li>
<li><a name="a637"></a>        <span class="src-comm">// ** Insertion des lignes définissant les triggers dans 'sys_definition_alarm_[type]'</span></li>
<li><a name="a638"></a>&nbsp;</li>
<li><a name="a639"></a>        <span class="src-key">for </span><span class="src-sym">(</span><span class="src-var">$i</span>=<span class="src-num">0</span><span class="src-sym">; </span><span class="src-var">$i </span>&lt; <a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$a_triggers</span><span class="src-sym">)</span><span class="src-sym">; </span><span class="src-var">$i</span>++<span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a640"></a>            <span class="src-key">foreach </span><span class="src-sym">(</span><span class="src-var">$a_triggers</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">] </span><span class="src-key">as </span><span class="src-var">$criticity </span>=&gt; <span class="src-var">$trigger</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a641"></a>                <span class="src-comm">//$sql = &quot;INSERT INTO sys_definition_alarm_&quot;.$a_type.&quot; (alarm_id, alarm_name, alarm_trigger_data_field, alarm_trigger_operand, alarm_trigger_type, id_group_table, network, time, family, alarm_trigger_value, critical_level, on_off) VALUES (&quot;.$a_id.&quot;, '&quot;.$a_name.&quot;', '&quot;.$trigger['data_field'].&quot;', '&quot;.$trigger['operand'].&quot;', '&quot;.$trigger['type'].&quot;', (SELECT id_ligne FROM sys_definition_group_table WHERE family = '&quot;.$a_family.&quot;' LIMIT 1), '&quot;.$a_na.&quot;', '&quot;.$a_ta.&quot;', '&quot;.$a_family.&quot;', '&quot;.$trigger['value'].&quot;', '&quot;.$criticity.&quot;', &quot;.$a_activate.&quot;)&quot;;</span></li>
<li><a name="a642"></a>&nbsp;</li>
<li><a name="a643"></a>                <span class="src-var">$sql </span>= <span class="src-str">&quot;INSERT INTO sys_definition_alarm_&quot;</span>.<span class="src-var">$a_type</span>.<span class="src-str">&quot; (alarm_id, alarm_name, alarm_trigger_data_field, alarm_trigger_operand, alarm_trigger_type, id_group_table, network, time, family, alarm_trigger_value, critical_level, on_off) VALUES (&quot;</span>.<span class="src-var">$a_id</span>.<span class="src-str">&quot;, '&quot;</span>.<span class="src-var">$a_name</span>.<span class="src-str">&quot;', '&quot;</span>.<span class="src-var">$trigger</span><span class="src-sym">[</span><span class="src-str">'data_field'</span><span class="src-sym">]</span>.<span class="src-str">&quot;', '&quot;</span>.<span class="src-var">$trigger</span><span class="src-sym">[</span><span class="src-str">'operand'</span><span class="src-sym">]</span>.<span class="src-str">&quot;', '&quot;</span>.<span class="src-var">$trigger</span><span class="src-sym">[</span><span class="src-str">'type'</span><span class="src-sym">]</span>.<span class="src-str">&quot;', 0, '&quot;</span>.<span class="src-var">$a_na</span>.<span class="src-str">&quot;', '&quot;</span>.<span class="src-var">$a_ta</span>.<span class="src-str">&quot;', '&quot;</span>.<span class="src-var">$a_family</span>.<span class="src-str">&quot;', '&quot;</span>.<span class="src-var">$trigger</span><span class="src-sym">[</span><span class="src-str">'value'</span><span class="src-sym">]</span>.<span class="src-str">&quot;', '&quot;</span>.<span class="src-var">$criticity</span>.<span class="src-str">&quot;', &quot;</span>.<span class="src-var">$a_activate</span>.<span class="src-str">&quot;)&quot;</span><span class="src-sym">;</span></li>
<li><a name="a644"></a>&nbsp;</li>
<li><a name="a645"></a>                <span class="src-comm">//echo $sql.&quot;&lt;br/&gt;&quot;;</span></li>
<li><a name="a646"></a>&nbsp;</li>
<li><a name="a647"></a>                <span class="src-var">$creation_state </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a648"></a>            <span class="src-sym">}</span></li>
<li><a name="a649"></a>        <span class="src-sym">}</span></li>
<li><a name="a650"></a>&nbsp;</li>
<li><a name="a651"></a>        <span class="src-comm">// ** Insertion des lignes définissant les champs additionnels dans 'sys_definition_alarm_[type]'</span></li>
<li><a name="a652"></a>&nbsp;</li>
<li><a name="a653"></a>        <span class="src-comm">// Note : les champs additionnels n'étant pas utilisés pour l'instant, on ne traite pas leur insertion en base</span></li>
<li><a name="a654"></a>&nbsp;</li>
<li><a name="a655"></a>        <span class="src-comm">// ** Insertion des lignes définissant les valeurs de na de l'alarme dans la table 'sys_definition_alarm_network_elements'</span></li>
<li><a name="a656"></a>        </li>
<li><a name="a657"></a>        <span class="src-key">if </span><span class="src-sym">(</span><span class="src-var">$creation_state</span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a658"></a>            <span class="src-var">$sql </span>= <span class="src-str">&quot;INSERT INTO sys_definition_alarm_network_elements (id_alarm, type_alarm, not_in, lst_alarm_compute) VALUES (&quot;</span>.<span class="src-var">$a_id</span>.<span class="src-str">&quot;, 'alarm_&quot;</span>.<span class="src-var">$a_type</span>.<span class="src-str">&quot;', 0, '&quot;</span>.<span class="src-var">$a_ne</span>.<span class="src-str">&quot;')&quot;</span><span class="src-sym">;</span></li>
<li><a name="a659"></a>&nbsp;</li>
<li><a name="a660"></a>            <span class="src-comm">//echo $sql.&quot;&lt;br/&gt;&quot;;</span></li>
<li><a name="a661"></a>&nbsp;</li>
<li><a name="a662"></a>            <span class="src-var">$creation_state </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$db_connection">db_connection</a><span class="src-sym">-&gt;</span><span class="src-id">executeQuery</span><span class="src-sym">(</span><span class="src-var">$sql</span><span class="src-sym">)</span><span class="src-sym">;            </span></li>
<li><a name="a663"></a>        <span class="src-sym">}</span></li>
<li><a name="a664"></a>&nbsp;</li>
<li><a name="a665"></a>        <span class="src-key">return </span><span class="src-var">$creation_state</span><span class="src-sym">;        </span></li>
<li><a name="a666"></a>    <span class="src-sym">}</span></li>
<li><a name="a667"></a>    </li>
<li><a name="a668"></a>    <span class="src-doc">/**</span></li>
<li><a name="a669"></a><span class="src-doc">     * Permet de transcrire les messages de l'application à partir de leurs identifiants</span></li>
<li><a name="a670"></a><span class="src-doc">     *</span></li>
<li><a name="a671"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@param </span><span class="src-doc-type">string </span><span class="src-doc-var">$word_id </span><span class="src-doc">identifiant du message</span></li>
<li><a name="a672"></a><span class="src-doc">     * </span><span class="src-doc-coretag">@return </span><span class="src-doc-type">string </span><span class="src-doc">le message traduit</span></li>
<li><a name="a673"></a><span class="src-doc">     */</span></li>
<li><a name="a674"></a>&nbsp;</li>
<li><a name="a675"></a>    <span class="src-key">function </span><a href="../Alarm/AlarmModel.html#methodtranslate">translate</a><span class="src-sym">(</span><span class="src-var">$word_id</span><span class="src-sym">)</span></li>
<li><a name="a676"></a>    <span class="src-sym">{</span></li>
<li><a name="a677"></a>        <span class="src-key">if</span><span class="src-sym">(</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$messages">messages</a><span class="src-sym">[</span><span class="src-var">$word_id</span><span class="src-sym">] </span>== <span class="src-str">&quot;&quot;</span><span class="src-sym">)</span><span class="src-sym">{</span></li>
<li><a name="a678"></a>            <span class="src-key">return </span><span class="src-str">'&lt;b style=&quot;color:red&quot;&gt;'</span>.<span class="src-var">$word_id</span>.<span class="src-str">'&lt;/b&gt;'</span><span class="src-sym">;</span></li>
<li><a name="a679"></a>        <span class="src-sym">}</span></li>
<li><a name="a680"></a>        <span class="src-key">else </span></li>
<li><a name="a681"></a>        <span class="src-sym">{</span></li>
<li><a name="a682"></a>            <span class="src-var">$txt </span>= <span class="src-var">$this</span><span class="src-sym">-&gt;</span><a href="../Alarm/AlarmModel.html#var$messages">messages</a><span class="src-sym">[</span><span class="src-var">$word_id</span><span class="src-sym">]</span><span class="src-sym">;</span></li>
<li><a name="a683"></a>&nbsp;</li>
<li><a name="a684"></a>            <span class="src-comm">// Si le nombre d'arguments est supérieur à 1 (le premier étant l'id du message)</span></li>
<li><a name="a685"></a>            <span class="src-comm">// on remplace les arguments dans le texte</span></li>
<li><a name="a686"></a>            <span class="src-var">$numArgs </span>= <a href="http://www.php.net/func_num_args">func_num_args</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a687"></a>            <span class="src-key">if </span><span class="src-sym">( </span><span class="src-var">$numArgs </span>&gt; <span class="src-num">1 </span><span class="src-sym">) </span><span class="src-sym">{</span></li>
<li><a name="a688"></a>                <span class="src-var">$arg_list </span>= <a href="http://www.php.net/func_get_args">func_get_args</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a689"></a>                <span class="src-comm">// remplace tous les arguments dans le texte</span></li>
<li><a name="a690"></a>                <span class="src-key">for </span><span class="src-sym">( </span><span class="src-var">$i </span>= <span class="src-num">1</span><span class="src-sym">; </span><span class="src-var">$i </span>&lt; <span class="src-var">$numArgs</span><span class="src-sym">; </span><span class="src-var">$i</span>++ <span class="src-sym">)</span></li>
<li><a name="a691"></a>                    <span class="src-var">$txt </span>= <a href="http://www.php.net/str_replace">str_replace</a><span class="src-sym">(</span><span class="src-str">'$'</span>.<span class="src-var">$i</span><span class="src-sym">, </span>(string) <span class="src-var">$arg_list</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">, </span><span class="src-var">$txt</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a692"></a>            <span class="src-sym">}</span></li>
<li><a name="a693"></a>            <span class="src-comm">// Supprime les arguments dans le texte qui sont en trop</span></li>
<li><a name="a694"></a>            <span class="src-var">$txt </span>= <a href="http://www.php.net/ereg_replace">ereg_replace</a><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str">(\\$<span class="src-sym">[</span>0-9<span class="src-sym">]</span>*)</span><span class="src-str">&quot;</span><span class="src-sym">, </span><span class="src-str">&quot;&quot;</span><span class="src-sym">, </span><span class="src-var">$txt</span><span class="src-sym">)</span><span class="src-sym">;</span></li>
<li><a name="a695"></a>&nbsp;</li>
<li><a name="a696"></a>            <span class="src-key">return </span><span class="src-var">$txt</span><span class="src-sym">;</span></li>
<li><a name="a697"></a>        <span class="src-sym">}</span></li>
<li><a name="a698"></a>    <span class="src-sym">}</span></li>
<li><a name="a699"></a><span class="src-sym">}</span></li>
<li><a name="a700"></a>&nbsp;</li>
<li><a name="a701"></a><span class="src-php">?&gt;</span></li>
</ol></pre>
</div>
	<p class="notes" id="credit">
		Documentation generated on Sun, 03 Aug 2008 18:03:10 +0200 by <a href="http://www.phpdoc.org" target="_blank">phpDocumentor 1.3.0RC3</a>
	</p>
	</body>
</html>